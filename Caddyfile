{
    # Enables on-demand TLS with domain validation
    on_demand_tls {
        ask https://caddy-api.1242601565.workers.dev/cert-allow
    }
}

:443 {
    reverse_proxy http://localhost:3000

    tls {
        on_demand
    }

    encode zstd gzip

    @nextStatic path /_next/static/*
    header @nextStatic Cache-Control "public, max-age=31536000, immutable"

    @nextImage path /_next/image*
    header @nextImage Cache-Control "public, max-age=31536000, immutable"
}
# Redirect HTTP to HTTPS
:80 {
    encode zstd gzip
    redir https://{host}{uri}
}